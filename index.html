<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SIPKADES v1.3.1</title>
  <style>
    body{font-family:Arial, sans-serif;margin:0;background:#f6f8fb;color:#333}
    header{background:#0b63d6;color:#fff;padding:10px 20px;display:flex;align-items:center;justify-content:space-between}
    header img{height:50px}
    nav{margin-top:10px}
    nav button{margin:5px;padding:8px 12px;border:none;border-radius:6px;cursor:pointer}
    #appMain{padding:20px}
    .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:20px}
    #logoutBtn{background:#d9534f;color:#fff}
    #loginBtn,#registerBtn{background:#0b63d6;color:#fff}
  </style>
</head>
<body>
  <header>
    <div><img id="logoImg" src="logo_desa.png" alt="Logo"></div>
    <div><strong>SIPKADES v1.3.1</strong></div>
    <div>
      <span id="loggedAs">Belum login</span>
      <button id="logoutBtn" style="display:none">Logout</button>
    </div>
  </header>

  <main id="appMain" style="display:none">
    <div class="card">
      <h2 id="panelTitle">Panel</h2>
      <p>Halo, <span id="rolePill"></span>. Silakan gunakan menu di bawah ini.</p>
    </div>
    <div class="card" id="userControls" style="display:none">
      <h3>Manajemen User (Admin)</h3>
      <div id="userList"></div>
    </div>
  </main>

  <section id="authArea" style="padding:20px">
    <div class="card" id="loginCard">
      <h2>Login</h2>
      <input id="loginUser" placeholder="Username"><br>
      <input id="loginPass" type="password" placeholder="Password"><br>
      <button id="loginBtn">Login</button>
      <p>Belum punya akun? <a href="#" onclick="toggleRegister()">Daftar</a></p>
    </div>
    <div class="card" id="registerCard" style="display:none">
      <h2>Registrasi</h2>
      <input id="regUser" placeholder="Username"><br>
      <input id="regPass" type="password" placeholder="Password"><br>
      <select id="regRole">
        <option value="bumdes">BUMDes</option>
        <option value="pemdes">Pemdes</option>
        <option value="bpd">BPD</option>
      </select><br>
      <button id="registerBtn">Register</button>
      <p>Sudah punya akun? <a href="#" onclick="toggleRegister()">Login</a></p>
    </div>
  </section>

  <script>
    let state={users:[],currentUser:null};
    const roles={
      'bumdes':{label:'BUMDes',logo:'logo_bumdes.png',positions:['Direktur Utama','Sekretaris','Bendahara','Manager Unit','Bendahara Unit','Pengawas']},
      'pemdes':{label:'Pemerintah Desa',logo:'logo_desa.png',positions:['Kepala Desa','Sekretaris Desa','Kasi','Kaur','Kasun','RT','RW','Tenaga IT']},
      'bpd':{label:'BPD',logo:'logo_desa.png',positions:['Ketua BPD','Sekretaris BPD','Anggota BPD']},
      'admin':{label:'Admin',logo:'logo_desa.png',positions:[]}
    };

    function saveState(){localStorage.setItem('sipkades',JSON.stringify(state))}
    function loadState(){const d=localStorage.getItem('sipkades');if(d){state=JSON.parse(d)}}
    function toggleRegister(){document.getElementById('loginCard').style.display=(document.getElementById('loginCard').style.display==='none')?'block':'none';document.getElementById('registerCard').style.display=(document.getElementById('registerCard').style.display==='none')?'block':'none'}

    function renderAppForUser(){
      loadState();
      if(!state.currentUser){
        authArea.style.display='block'; appMain.style.display='none'; logoutBtn.style.display='none';
        document.getElementById('loginCard').style.display='block';
        document.getElementById('registerCard').style.display='none';
        loggedAs.textContent='Belum login';
        logoImg.src='logo_desa.png'; // default logo Pemdes
        return;
      }
      authArea.style.display='none'; appMain.style.display='block'; logoutBtn.style.display='inline-block';
      loggedAs.textContent='Masuk sebagai: '+state.currentUser.username+' ('+state.currentUser.role+')';
      const roleKey=state.currentUser.role; const roleObj=roles[roleKey]||roles['pemdes'];
      logoImg.src=roleObj.logo;
      rolePill.textContent=roleObj.label; panelTitle.textContent='Panel: '+roleObj.label;
      document.getElementById('userControls').style.display=(state.currentUser.role==='admin')?'block':'none';
    }

    loginBtn.onclick=()=>{
      const u=loginUser.value,p=loginPass.value;
      const found=state.users.find(x=>x.username===u&&x.password===p);
      if(found){state.currentUser=found;saveState();renderAppForUser();}else{alert('Login gagal');}
    };
    registerBtn.onclick=()=>{
      const u=regUser.value,p=regPass.value,r=regRole.value;
      if(!u||!p)return alert('Lengkapi data');
      if(state.users.find(x=>x.username===u))return alert('User sudah ada');
      const newUser={username:u,password:p,role:r};state.users.push(newUser);state.currentUser=newUser;saveState();renderAppForUser();
    };
    logoutBtn.onclick=()=>{state.currentUser=null;saveState();renderAppForUser()}

    renderAppForUser();
  </script>
</body>
</html>
